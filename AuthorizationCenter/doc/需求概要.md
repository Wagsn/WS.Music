# 需求概要

权限管理系统是基于用户角色组织等管理的一个能对其他业务系统进行权限管理的基础系统。权限管理系统包含前端后端，使用户能够方便明了的进行权限配置，同时系统稳定可靠。
权限管理系统需要使用的技术或者第三方组件如下，其他需要使用到的根据自己需求任意选择：
.Net Core 2.1、EF Core 2.1、Swagger、AutoMapper、AspNet Core、LayUI、MySql


## 系统应该有如下几个大的模块

### 组织管理模块
组织为企业或其他社会机构的内部结构划分，数据结构成树形，可以无限级的扩展同级组织和下级组织。
组织管理需要实现基础的增删改查操作，同时，组织应该有类型的区别。

### 用户管理模块
用户作为权限管理系统的基本组成，权限的授予、取消最终都是体现到系统中的用户。
用户能够登录系统，能够在权限的控制下进行系统操作。
用户管理应该实现增删改查操作
用户登录操作
用户退出登录操作
用户应该归属于某一个组织

### 角色管理模块
角色作为用户的身份识别，同时也作为一些权限项的集合。
角色管理应该实现增删改查操作
角色也应该归属于某一个组织

### 权限项管理模块
权限项是作为权限管理的基础元素，是某一个系统操作的抽象定义，由开发人员提前定义好，并且在代码里面作为一个权限判断的标志。
权限项管理应该实现基础的真删改查操作。
权限项应该有分组的设置。

### 用户角色管理模块
用户可以拥有多个角色，角色也可以拥有多个用户，多对多的关系，此模块是用户角色关系的维护。
可以给一个用户赋予一个或多个角色。
可以取消一个用户的一个或多个角色。
可以查询一个用户有哪些角色。
可以查询一个角色拥有哪些用户。

### 授权管理模块
授权管理可以为一个角色绑定多个权限项，表示该角色拥有这些权限项，同时每一个绑定关系都应该关联到组织。表示一个角色的一个权限项的使用范围。同时为了灵活需要有一个全部和本组织的自定义选择，全部表示这个权限项的使用范围没有限制，本组织表示这个权限项的使用范围为用户所在组织内。
可以为一个角色赋予多个权限项，同时每个权限项可以设置一个组织范围。
可以查看一个角色的权限项和每个权限项的组织范围。
可以查看一个用户的权限项和每个权限项的组织范围。
可以修改。

### 权限查询模块
权限查询模块是作为权限管理系统的一个应用。
查询一个用户的一个权限项所包含的权限组织。
查询一个用户是否有一个权限项。
查询一个用户是否有一个权限项在某个组织中。


## 系统需要实现的业务逻辑
1、由于用户和角色是多对多的关系，所以当把权限具体到某一个人的时候，该用户的权限应该是多个角色拥有权限的并集，包括相同权限项的权限范围应该合并取并集。
2、由于是权限管理系统，所以在用户，角色，组织的增删改查的时候应该做权限控制。赋予角色，赋予权限等具体操作也应该有相应的权限控制。
3、具体的权限控制应该是数据归属组织与权限项操作范围组织是否相等或者被包含来判定。
4、权限项的组织范围应该是向下包含，拥有了一个组织的权限，就自动包含该组织所有下级组织的权限，因此在权限项选择了组织范围的时候，如果同时选择了上下级的组织，应该不保存下级组织，自动过滤。


## 需要包含的一些数据处理逻辑
为了提高权限管理系统的效率，需要对权限设置的数据进行预处理，具体的预处理应该有如下几点：
1、	权限最终是确定到用户上的，所以应该对用户角色权限组织数据做一个预处理，应该生成一张预处理表，里面包含用户、权限项、权限组织三个字段。作为权限查询的数据来源。
2、	由于组织是可以无限扩展的，且包含层级关系，所以组织数据也应该进行预处理，应该生成一张预处理表，里面包含父级，子级，是否直接关系三个字段。每个组织都应该把所有子级对应起来存到预处理表中。
3、	上述两点要配合业余操作进行变更，例如，一个用户被删除，那么权限预处理表中应该清除该用户的所有数据。一个用户被取消了一个角色，那么权限预处理表中应该把该用户的对应的取消的角色相关的权限项给去除。等等。同样组织预处理表也应该进行相应的变化。
