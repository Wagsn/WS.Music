# 授权中心 - 文档


## 需求概要

权限管理系统是基于用户角色组织等管理的一个能对其他业务系统进行权限管理的基础系统。权限管理系统包含前端后端，使用户能够方便明了的进行权限配置，同时系统稳定可靠。
权限管理系统需要使用的技术或者第三方组件如下，其他需要使用到的根据自己需求任意选择：
.Net Core 2.1、EF Core 2.1、Swagger、AutoMapper、AspNet Core、LayUI、MySql

### 系统应该有如下几个大的模块

#### 组织管理模块
组织为企业或其他社会机构的内部结构划分，数据结构成树形，可以无限级的扩展同级组织和下级组织。
组织管理需要实现基础的增删改查操作，同时，组织应该有类型的区别。

#### 用户管理模块
用户作为权限管理系统的基本组成，权限的授予、取消最终都是体现到系统中的用户。
用户能够登录系统，能够在权限的控制下进行系统操作。
用户管理应该实现增删改查操作
用户登录操作
用户退出登录操作
用户应该归属于某一个组织

#### 角色管理模块
角色作为用户的身份识别，同时也作为一些权限项的集合。
角色管理应该实现增删改查操作
角色也应该归属于某一个组织

#### 权限项管理模块
权限项是作为权限管理的基础元素，是某一个系统操作的抽象定义，由开发人员提前定义好，并且在代码里面作为一个权限判断的标志。
权限项管理应该实现基础的真删改查操作。
权限项应该有分组的设置。

#### 用户角色管理模块
用户可以拥有多个角色，角色也可以拥有多个用户，多对多的关系，此模块是用户角色关系的维护。
可以给一个用户赋予一个或多个角色。
可以取消一个用户的一个或多个角色。
可以查询一个用户有哪些角色。
可以查询一个角色拥有哪些用户。

#### 授权管理模块
授权管理可以为一个角色绑定多个权限项，表示该角色拥有这些权限项，同时每一个绑定关系都应该关联到组织。表示一个角色的一个权限项的使用范围。同时为了灵活需要有一个全部和本组织的自定义选择，全部表示这个权限项的使用范围没有限制，本组织表示这个权限项的使用范围为用户所在组织内。
可以为一个角色赋予多个权限项，同时每个权限项可以设置一个组织范围。
可以查看一个角色的权限项和每个权限项的组织范围。
可以查看一个用户的权限项和每个权限项的组织范围。
可以修改。

#### 权限查询模块
权限查询模块是作为权限管理系统的一个应用。
查询一个用户的一个权限项所包含的权限组织。
查询一个用户是否有一个权限项。
查询一个用户是否有一个权限项在某个组织中。


### 系统需要实现的业务逻辑
1、由于用户和角色是多对多的关系，所以当把权限具体到某一个人的时候，该用户的权限应该是多个角色拥有权限的并集，包括相同权限项的权限范围应该合并取并集。
2、由于是权限管理系统，所以在用户，角色，组织的增删改查的时候应该做权限控制。赋予角色，赋予权限等具体操作也应该有相应的权限控制。
3、具体的权限控制应该是数据归属组织与权限项操作范围组织是否相等或者被包含来判定。
4、权限项的组织范围应该是向下包含，拥有了一个组织的权限，就自动包含该组织所有下级组织的权限，因此在权限项选择了组织范围的时候，如果同时选择了上下级的组织，应该不保存下级组织，自动过滤。


### 需要包含的一些数据处理逻辑
为了提高权限管理系统的效率，需要对权限设置的数据进行预处理，具体的预处理应该有如下几点：
1、	权限最终是确定到用户上的，所以应该对用户角色权限组织数据做一个预处理，应该生成一张预处理表，里面包含用户、权限项、权限组织三个字段。作为权限查询的数据来源。
2、	由于组织是可以无限扩展的，且包含层级关系，所以组织数据也应该进行预处理，应该生成一张预处理表，里面包含父级，子级，是否直接关系三个字段。每个组织都应该把所有子级对应起来存到预处理表中。
3、	上述两点要配合业余操作进行变更，例如，一个用户被删除，那么权限预处理表中应该清除该用户的所有数据。一个用户被取消了一个角色，那么权限预处理表中应该把该用户的对应的取消的角色相关的权限项给去除。等等。同样组织预处理表也应该进行相应的变化。



## 开发计划

开发人员：Wagsn
项目名称：授权中心（权限管理）
起止时间：2018/12/10-2018/01/03
预计时间：25天
项目时间：16天

### 阶段进度

时段：18/12/10
任务：调休

时段：18/12/11
任务：用户CRUD单元模块（单元模块：进行元数据操作）
输出：超级管理员使用编辑界面进行添加修改删除操作（对所有用户）

时段：18/12/12
任务：用户登陆模块
输出：使用登陆界面进行注册登陆登出操作

时段：18/12/13-14
任务：用户管理模块
输出：系统超级管理员使用用户管理界面进行用户管理，包含增删查改操作

时段：18/12/15-16
任务：周末

时段：18/12/17
任务：角色CRUD单元模块
输出：使用角色编辑界面进行添加修改删除操作

时段：18/12/18-19
任务：用户关联角色
输出：在用户管理界面中可以将角色绑定到用户上面，用户登陆系统之后可以看到自己的角色信息

时段：18/12/20
任务：组织CRUD单元模块
输出：超级管理员使用组织编辑界面进行组织增删查改操作

时段：18/12/21
任务：用户创建管理组织
输出：用户登陆系统之后可以创建组织，并绑定到组织上，也可以取消绑定

时段：18/12/22-23
任务：周末

时段：18/12/24
任务：调休

时段：18/12/25
任务：权限CRUD单元模块
输出：超级管理员使用权限编辑界面进行权限的增删查改操作

时段：18/12/26
任务：角色组织关联 -作用是为用户添加角色的时候将显示该组织的角色
输出：超级管理员角色编辑界面将角色挂靠到组织下面

时段：18/12/27
任务：角色权限关联
输出：超级管理员使用角色编辑界面将角色与权限关联，用户在权限限制下访问数据

时段：18/12/28
任务：组织权限关联
输出：超级管理元使用组织编辑界面，将组织与权限关联，用户访问数据将受到组织和权限限制

时段：18/12/29-30
任务：周末

时段：18/12/31
任务：权限管理
输出：整合权限管理界面，超级管理员可以直接进行角色权限组织的关联

时段：18/01/01
任务：元旦

时段：18/12/02-18/01/03
任务：综合测试
输出：测试超级管理员的管理界面以及用户在权限组织限制下的数据访问，达到稳定安全的访问数据，系统概要设计文档

**补充说明**：如果当天的任务不足以完成将会使用晚上及周末补充


## 数据库设计

Letter: [a-zA-Z]
Digit: [0-9]
Word: [\w]
String: [\s\S]
Bit: [0|1]
Hex: [0-9a-fA-F]
Octal: [0-7]
GUID: Hex{8}-Hex{4}-Hex{4}-Hex{4}-Hex{12}

### 用户: User

Id: GUID
SignName: Letter{2,15}
PassWord: [Letter|Digit]{6, 63}
NickName: Letter{1,31}
Email: String{, 255}

### 角色（通用）: Role 

Id: GUID
Name: [Letter|Digit]{2,15}
Descripttion: String{,255}

### 组织：Organization

Id: GUID
Code: Digit{12}
Name: Word{2,15}
Description: String{,255}
ParentId： GUID

### 权限（通用）: Permission

Id: GUID
Name: Word{2,15}
Description: String{,255}

### 用户角色关系表（每个角色是特别的）

UserId: GUID
RoleId: GUID

### 角色组织关系表（每个角色是特别的，如果角色公用的话要进行角色-权限-组织同时关联）

RoleId: GUID
OrganizationId: GUID

### 角色权限关系表

RoleId: GUID
PermissionId: GUID

### 角色权限组织表(实现角色通用化?)

RoleId: GUID
PermissionId: GUID
OrgnizatioinId: GUID

### 用户组织关系表（??是否需要，用户与角色，角色与组织，拆解成用户和组织）

UserId: GUID
OrganizatiionId: GUID

