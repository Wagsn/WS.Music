<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="/lib/layui/css/layui.css" media="all">
    <title>歌曲添加 - 后台管理</title>
</head>
<body class="song-add-body">
    <form class="layui-form">
        <div class="layui-form-item">
            <label class="layui-form-label">歌名：</label>
            <div class="layui-input-block">
                <input class="layui-input song-name" lay-verify="required" placeholder="请输入歌名" type="text">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">歌手：</label>
            <div class="layui-input-block">
                <input class="layui-input song-artist-name" lay-verify="required" placeholder="请输入歌手" type="text">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">专辑：</label>
            <div class="layui-input-block">
                <input class="layui-input song-album-name" lay-verify="required" placeholder="请输入专辑" type="text">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">说明：</label>
            <div class="layui-input-block">
                <input class="layui-input song-album-name" lay-verify="required" placeholder="请输入专辑" type="text">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">时长：</label>
            <div class="layui-input-block">
                <input class="layui-input song-album-name" lay-verify="required" placeholder="请输入专辑" type="text">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">发行时间：</label>
            <div class="layui-input-block">
                <input class="layui-input song-album-name" lay-verify="required" placeholder="请输入专辑" type="text">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">资源：</label>
            <div class="layui-input-block">
                <input class="layui-input song-album-name" lay-verify="required" placeholder="请输入专辑" type="text">
            </div>
        </div>
        <!--<div class="layui-form-item">
            <label class="layui-form-label">选择专业：</label>
            <div class="layui-input-inline">
                <select class="major_select" id="major_mid" name="typeid" lay-verify="required" lay-search="" lay-filter="major_select">
                    <option value="">直接选择</option>
                </select>
            </div>
            <label class="layui-form-label">选择班级：</label>
            <div class="layui-input-inline">
                <select class="class_select" id="class_mid" name="modules" lay-verify="required" lay-search="">
                    <option value="">直接选择</option>
                </select>
            </div>
        </div>-->

        <div class="layui-form-item">
            <label class="layui-form-label">邮箱地址：</label>
            <div class="layui-input-block">
                <input class="layui-input email" lay-verify="required" placeholder="请输入邮箱地址" type="text">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">电话号码：</label>
            <div class="layui-input-block">
                <input class="layui-input MobileNumber" lay-verify="required" placeholder="请输入电话号码" type="text">
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-input-block">
                <button type="button" id="saveform" class="layui-btn" lay-filter="studentAdd_btn">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
    <!--<script src="http://mockjs.com/dist/mock.js"></script>-->
    <script type="text/javascript" src="/lib/layui/layui.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.4.0/jquery.min.js "></script>

    <script type="text/javascript">
        layui.use(['form', 'jquery'], function () {
            console.log("teacherAll.html added");
            var form = layui.form;
            $ = layui.jquery;
            //Mock.mock(
            //    'http://mockjscdddd', {
            //        "x1": 1,
            //        "userid": '11'
            //    }
            //);
            $(document).ready(function () {
                // 获取专业列表 major/list
                //$.ajax({
                //    type: "get",
                //    async: true,
                //    url: "api/major/list",
                //    contentType: 'application/json',
                //    dataType: 'json',
                //    success: function (body) {
                //        //console.log(data);
                //        if (body.code == '200') {
                //            renderSelect(".major_select", body.data, 'id', 'majorName');
                //        } else {
                //            alert('专业列表获取失败');
                //        }
                //    },
                //    error: function (e) {
                //        alert("发生错误：" + e.status);
                //    }
                //});
                //// 获取班级列表 class/list
                //$.ajax({
                //    type: "get",
                //    async: true,
                //    url: "api/class/list",
                //    contentType: 'application/json',
                //    dataType: 'json',
                //    success: function (body) {
                //        //console.log(data);
                //        if (body.code == '200') {
                //            renderSelect(".class_select", body.data, 'id', 'className');
                //        } else {
                //            alert('班级列表获取失败');
                //        }
                //    },
                //    error: function (e) {
                //        alert("发生错误：" + e.status);
                //    }
                //});
            })
            // 监听专业选择器的变化
            form.on('select(major_select)', function (data) {
                // 获取班级列表 class/list
                $.ajax({
                    type: "get",
                    async: true,
                    url: "api/class/list/major/" + data.value,
                    contentType: 'application/json',
                    dataType: 'json',
                    success: function (body) {
                        //console.log(data);
                        if (body.code == '200') {
                            renderSelect(".class_select", body.data, 'id', 'className');
                        } else {
                            alert('班级列表获取失败');
                        }
                    },
                    error: function (e) {
                        alert("发生错误：" + e.status);
                    }
                });
            });
            // 通用的选择器渲染
            function renderSelect(selector, data, value, text) {
                console.log("通用选择器渲染开始，数据为：", data)
                let select = $(selector)
                let select_html = ('<option value="">直接选择或搜索选择</option>');
                for (let item of data) {
                    select_html += '<option value="' + item[value] + '">' + item[text] + '</option>';
                }
                select.html(select_html);
                form.render();
            }
            /*点击保存*/
            $("#saveform").click(function () {
                console.log("saveform clicked");
                var index = top.layer.msg('数据提交中，请稍候', { icon: 16, time: false, shade: 0.8 });
                setTimeout(function () {
                    //ajax提交添加请求
                    addstudent();
                    //关闭加载层
                    top.layer.close(index);
                    //提示成功
                    top.layer.msg("添加成功！");
                    layer.closeAll("iframe");
                    //刷新父页面
                    parent.location.reload();
                }, 1000);
                return true;
            })
            function addstudent() {
                /*获取表单数据打包json数据*/
                var major_id = $("#major_mid").find("option:selected").val();
                var class_id = $("#class_mid").find("option:selected").val();
                var studentNo = $(".studentNo").val();
                var passWord = $(".passWord").val();
                var name = $(".name").val();
                var email = $(".email").val();
                var MobileNumber = $(".MobileNumber").val();
                var t = {
                    'studentNo': studentNo,
                    'passWord': passWord,
                    'name': name,
                    'majorId': major_id,
                    'classId': class_id,
                    'email': email,
                    'mobileNumber': MobileNumber,
                }
                console.log(t)
                $.ajax({
                    type: "post",
                    async: true,
                    url: "api/student/save",
                    data: JSON.stringify({
                        'studentNo': studentNo,
                        'passWord': passWord,
                        'name': name,
                        'majorId': major_id,
                        'classId': class_id,
                        'email': email,
                        'mobileNumber': MobileNumber,
                    }),
                    contentType: 'application/json',
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                        if (data.code == "200") {
                            alert('添加成功！');
                            console.log(data)
                            window.location.reload();//刷新当前页面
                        } else {
                            alert('添加失败');
                        }
                    },
                    error: function (e) {
                        alert("发生错误：" + e.status);
                    }
                });
            }
        });

    </script>
</body>
</html>